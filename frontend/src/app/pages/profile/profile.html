<div class="profile-container">
  <div class="profile-header">
    <h2>Your Profile</h2>
    <button (click)="toggleEdit()" class="edit-button">
      {{ isEditing ? 'Cancel' : 'Edit Profile' }}
    </button>
  </div>
  
  <div class="profile-content">
    @if (authService.currentUser(); as user) {
      <div class="profile-image-section">
        <img [src]="previewImageUrl || user.profileImageUrl || 'assets/default-profile.png'" 
             alt="Profile Image" class="profile-image">
        @if (isEditing) {
          <div class="image-upload">
            <input type="file" accept="image/*" (change)="onFileSelected($event)">
          </div>
        }
      </div>

      <div class="profile-details">
        @if (!isEditing) {
          <div class="detail-item">
            <label>Name:</label>
            <span>{{ user.name }}</span>
          </div>
          <div class="detail-item">
            <label>Email:</label>
            <span>{{ user.email }}</span>
          </div>
          @if (user.phone) {
            <div class="detail-item">
              <label>Phone:</label>
              <span>{{ user.phone }}</span>
            </div>
          }
          @if (user.dateOfBirth) {
            <div class="detail-item">
              <label>Date of Birth:</label>
              <span>{{ user.dateOfBirth | date }}</span>
            </div>
          }
          @if (user.bio) {
            <div class="detail-item">
              <label>Bio:</label>
              <p>{{ user.bio }}</p>
            </div>
          }
        }

        @if (isEditing) {
          <div class="edit-form">
            <div class="form-group">
              <label for="name">Name:</label>
              <input id="name" [(ngModel)]="editedUser.name" type="text">
            </div>
            <div class="form-group">
              <label for="email">Email:</label>
              <input id="email" [(ngModel)]="editedUser.email" type="email" disabled>
            </div>
            <div class="form-group">
              <label for="phone">Phone:</label>
              <input id="phone" [(ngModel)]="editedUser.phone" type="tel">
            </div>
            <div class="form-group">
              <label for="dob">Date of Birth:</label>
              <input id="dob" [(ngModel)]="editedUser.dateOfBirth" type="date">
            </div>
            <div class="form-group">
              <label for="bio">Bio:</label>
              <textarea id="bio" [(ngModel)]="editedUser.bio" rows="4"></textarea>
            </div>
            <button (click)="saveProfile()" class="save-button">Save Changes</button>
          </div>
        }
      </div>
    }
  </div>

  <div class="favorites-section">
    <h3>Your Favorite Properties</h3>
    @if (authService.currentUser()?.favorites?.length) {
      <div class="favorites-list">
        @for (propertyId of authService.currentUser()!.favorites; track propertyId) {
          <div class="favorite-item">
            <app-property-details [propertyId]="propertyId" [compactView]="true"></app-property-details>
            <button (click)="removeFavorite(propertyId)" class="remove-favorite">Remove</button>
          </div>
        }
      </div>
    } @else {
      <div class="no-favorites">
        You haven't added any properties to your favorites yet.
      </div>
    }
  </div>

  <div class="booked-section">
    <h2>Your Booked Homes</h2>
    @if (bookedHomes.length > 0) {
      <div class="booked-list">
        @for (home of bookedHomes; track home._id) {
          <div class="booked-card">
            <app-property-details [propertyId]="home._id" [compactView]="true"></app-property-details>
            <button (click)="cancelBooking(home)" class="cancel-button">
              Cancel Booking
            </button>
          </div>
        }
      </div>
    } @else {
      <div class="no-bookings">
        <p>You haven't booked any properties yet.</p>
        <a (click)="navigateToHome()" class="explore-button">Explore Properties</a>
      </div>
    }
  </div>
</div>